var Et=Object.create;var j=Object.defineProperty;var wt=Object.getOwnPropertyDescriptor;var St=Object.getOwnPropertyNames;var xt=Object.getPrototypeOf,At=Object.prototype.hasOwnProperty;var Ct=(e,t,n)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var It=e=>j(e,"__esModule",{value:!0});var b=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Tt=(e,t,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of St(t))!At.call(e,r)&&r!=="default"&&j(e,r,{get:()=>t[r],enumerable:!(n=wt(t,r))||n.enumerable});return e},Lt=e=>Tt(It(j(e!=null?Et(xt(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var g=(e,t,n)=>(Ct(e,typeof t!="symbol"?t+"":t,n),n);var E=(e,t,n)=>new Promise((r,a)=>{var i=c=>{try{l(n.next(c))}catch(s){a(s)}},o=c=>{try{l(n.throw(c))}catch(s){a(s)}},l=c=>c.done?r(c.value):Promise.resolve(c.value).then(i,o);l((n=n.apply(e,t)).next())});var Ie=b((Ar,Ce)=>{"use strict";var N,C,k=0;function F(e){return e>=48&&e<=57}function P(e,t){for(var n=(e+="").length,r=(t+="").length,a=0,i=0;a<n&&i<r;){var o=e.charCodeAt(a),l=t.charCodeAt(i);if(F(o)){if(!F(l))return o-l;for(var c=a,s=i;o===48&&++c<n;)o=e.charCodeAt(c);for(;l===48&&++s<r;)l=t.charCodeAt(s);for(var u=c,d=s;u<n&&F(e.charCodeAt(u));)++u;for(;d<r&&F(t.charCodeAt(d));)++d;var m=u-c-d+s;if(m)return m;for(;c<u;)if(m=e.charCodeAt(c++)-t.charCodeAt(s++),m)return m;a=u,i=d;continue}if(o!==l)return o<k&&l<k&&C[o]!==-1&&C[l]!==-1?C[o]-C[l]:o-l;++a,++i}return a>=n&&i<r&&n>=r?-1:i>=r&&a<n&&r>=n?1:n-r}P.caseInsensitive=P.i=function(e,t){return P((""+e).toLowerCase(),(""+t).toLowerCase())};Object.defineProperties(P,{alphabet:{get:function(){return N},set:function(e){N=e,C=[];var t=0;if(N)for(;t<N.length;t++)C[N.charCodeAt(t)]=t;for(k=C.length,t=0;t<k;t++)C[t]===void 0&&(C[t]=-1)}}});Ce.exports=P});var V=b((Cr,Te)=>{var $t=function(e,t,n){return n?e.getElementsByClassName(t)[0]:e.getElementsByClassName(t)},Rt=function(e,t,n){return t="."+t,n?e.querySelector(t):e.querySelectorAll(t)},Mt=function(e,t,n){for(var r=[],a="*",i=e.getElementsByTagName(a),o=i.length,l=new RegExp("(^|\\s)"+t+"(\\s|$)"),c=0,s=0;c<o;c++)if(l.test(i[c].className)){if(n)return i[c];r[s]=i[c],s++}return r};Te.exports=function(){return function(e,t,n,r){return r=r||{},r.test&&r.getElementsByClassName||!r.test&&document.getElementsByClassName?$t(e,t,n):r.test&&r.querySelector||!r.test&&document.querySelector?Rt(e,t,n):Mt(e,t,n)}}()});var X=b((Ir,Le)=>{Le.exports=function(t){for(var n=Array.prototype.slice.call(arguments,1),r=0,a;a=n[r];r++)if(!!a)for(var i in a)t[i]=a[i];return t}});var Z=b((Tr,Oe)=>{var jt=[].indexOf;Oe.exports=function(e,t){if(jt)return e.indexOf(t);for(var n=0,r=e.length;n<r;++n)if(e[n]===t)return n;return-1}});var ee=b((Lr,Ne)=>{Ne.exports=function(t){if(typeof t=="undefined")return[];if(t===null)return[null];if(t===window)return[window];if(typeof t=="string")return[t];if(Dt(t))return t;if(typeof t.length!="number")return[t];if(typeof t=="function"&&t instanceof Function)return[t];for(var n=[],r=0,a=t.length;r<a;r++)(Object.prototype.hasOwnProperty.call(t,r)||r in t)&&n.push(t[r]);return n.length?n:[]};function Dt(e){return Object.prototype.toString.call(e)==="[object Array]"}});var U=b(Q=>{var Pe=window.addEventListener?"addEventListener":"attachEvent",kt=window.removeEventListener?"removeEventListener":"detachEvent",$e=Pe!=="addEventListener"?"on":"",qe=ee();Q.bind=function(e,t,n,r){e=qe(e);for(var a=0,i=e.length;a<i;a++)e[a][Pe]($e+t,n,r||!1)};Q.unbind=function(e,t,n,r){e=qe(e);for(var a=0,i=e.length;a<i;a++)e[a][kt]($e+t,n,r||!1)};Q.debounce=function(e,t,n){var r;return t?function(){var a=this,i=arguments,o=function(){r=null,n||e.apply(a,i)},l=n&&!r;clearTimeout(r),r=setTimeout(o,t),l&&e.apply(a,i)}:e}});var te=b((Nr,Re)=>{Re.exports=function(e){return e=e===void 0?"":e,e=e===null?"":e,e=e.toString(),e}});var G=b((Pr,Me)=>{var re=Z(),Ft=/\s+/;Me.exports=function(e){return new I(e)};function I(e){if(!e||!e.nodeType)throw new Error("A DOM element reference is required");this.el=e,this.list=e.classList}I.prototype.add=function(e){if(this.list)return this.list.add(e),this;var t=this.array(),n=re(t,e);return~n||t.push(e),this.el.className=t.join(" "),this};I.prototype.remove=function(e){if(this.list)return this.list.remove(e),this;var t=this.array(),n=re(t,e);return~n&&t.splice(n,1),this.el.className=t.join(" "),this};I.prototype.toggle=function(e,t){return this.list?(typeof t!="undefined"?t!==this.list.toggle(e,t)&&this.list.toggle(e):this.list.toggle(e),this):(typeof t!="undefined"?t?this.add(e):this.remove(e):this.has(e)?this.remove(e):this.add(e),this)};I.prototype.array=function(){var e=this.el.getAttribute("class")||"",t=e.replace(/^\s+|\s+$/g,""),n=t.split(Ft);return n[0]===""&&n.shift(),n};I.prototype.has=I.prototype.contains=function(e){return this.list?this.list.contains(e):!!~re(this.array(),e)}});var De=b(($r,je)=>{je.exports=function(e,t){var n=e.getAttribute&&e.getAttribute(t)||null;if(!n)for(var r=e.attributes,a=r.length,i=0;i<a;i++)r[i]!==void 0&&r[i].nodeName===t&&(n=r[i].nodeValue);return n}});var ne=b((qr,ke)=>{ke.exports=function(e){return function(t,n,r){var a=this;this._values={},this.found=!1,this.filtered=!1;var i=function(o,l,c){if(l===void 0)c?a.values(o,c):a.values(o);else{a.elm=l;var s=e.templater.get(a,o);a.values(s)}};this.values=function(o,l){if(o!==void 0){for(var c in o)a._values[c]=o[c];l!==!0&&e.templater.set(a,a.values())}else return a._values},this.show=function(){e.templater.show(a)},this.hide=function(){e.templater.hide(a)},this.matching=function(){return e.filtered&&e.searched&&a.found&&a.filtered||e.filtered&&!e.searched&&a.filtered||!e.filtered&&e.searched&&a.found||!e.filtered&&!e.searched},this.visible=function(){return!!(a.elm&&a.elm.parentNode==e.list)},i(t,n,r)}}});var Qe=b((Rr,Fe)=>{Fe.exports=function(e){var t=function(n,r,a){var i=n.splice(0,50);a=a||[],a=a.concat(e.add(i)),n.length>0?setTimeout(function(){t(n,r,a)},1):(e.update(),r(a))};return t}});var He=b((Mr,Ge)=>{var Ue=G(),Qt=U(),Ut=ae();Ge.exports=function(e){var t=!1,n=function(a,i){if(e.page<1){e.listContainer.style.display="none",t=!0;return}else t&&(e.listContainer.style.display="block");var o,l=e.matchingItems.length,c=e.i,s=e.page,u=Math.ceil(l/s),d=Math.ceil(c/s),m=i.innerWindow||2,p=i.left||i.outerWindow||0,f=i.right||i.outerWindow||0;f=u-f,a.clear();for(var h=1;h<=u;h++){var v=d===h?"active":"";r.number(h,p,f,d,m)?(o=a.add({page:h,dotted:!1})[0],v&&Ue(o.elm).add(v),o.elm.firstChild.setAttribute("data-i",h),o.elm.firstChild.setAttribute("data-page",s)):r.dotted(a,h,p,f,d,m,a.size())&&(o=a.add({page:"...",dotted:!0})[0],Ue(o.elm).add("disabled"))}},r={number:function(a,i,o,l,c){return this.left(a,i)||this.right(a,o)||this.innerWindow(a,l,c)},left:function(a,i){return a<=i},right:function(a,i){return a>i},innerWindow:function(a,i,o){return a>=i-o&&a<=i+o},dotted:function(a,i,o,l,c,s,u){return this.dottedLeft(a,i,o,l,c,s)||this.dottedRight(a,i,o,l,c,s,u)},dottedLeft:function(a,i,o,l,c,s){return i==o+1&&!this.innerWindow(i,c,s)&&!this.right(i,l)},dottedRight:function(a,i,o,l,c,s,u){return a.items[u-1].values().dotted?!1:i==l&&!this.innerWindow(i,c,s)&&!this.right(i,l)}};return function(a){var i=new Ut(e.listContainer.id,{listClass:a.paginationClass||"pagination",item:a.item||"<li><a class='page' href='#'></a></li>",valueNames:["page","dotted"],searchClass:"pagination-search-that-is-not-supposed-to-exist",sortClass:"pagination-sort-that-is-not-supposed-to-exist"});Qt.bind(i.listContainer,"click",function(o){var l=o.target||o.srcElement,c=e.utils.getAttribute(l,"data-page"),s=e.utils.getAttribute(l,"data-i");s&&e.show((s-1)*c+1,c)}),e.on("updated",function(){n(i,a)}),n(i,a)}}});var ze=b((jr,Be)=>{Be.exports=function(e){var t=ne()(e),n=function(i){for(var o=i.childNodes,l=[],c=0,s=o.length;c<s;c++)o[c].data===void 0&&l.push(o[c]);return l},r=function(i,o){for(var l=0,c=i.length;l<c;l++)e.items.push(new t(o,i[l]))},a=function(i,o){var l=i.splice(0,50);r(l,o),i.length>0?setTimeout(function(){a(i,o)},1):(e.update(),e.trigger("parseComplete"))};return e.handlers.parseComplete=e.handlers.parseComplete||[],function(){var i=n(e.list),o=e.valueNames;e.indexAsync?a(i,o):r(i,o)}}});var We=b((Dr,Ke)=>{var Gt=function(e){var t,n=this,r=function(){var s;if(typeof e.item=="function"){t=function(u){var d=e.item(u);return o(d)};return}if(typeof e.item=="string"?e.item.indexOf("<")===-1?s=document.getElementById(e.item):s=o(e.item):s=i(),!s)throw new Error("The list needs to have at least one item on init otherwise you'll have to add a template.");s=a(s,e.valueNames),t=function(){return s.cloneNode(!0)}},a=function(s,u){var d=s.cloneNode(!0);d.removeAttribute("id");for(var m=0,p=u.length;m<p;m++){var f=void 0,h=u[m];if(h.data)for(var v=0,_=h.data.length;v<_;v++)d.setAttribute("data-"+h.data[v],"");else h.attr&&h.name?(f=e.utils.getByClass(d,h.name,!0),f&&f.setAttribute(h.attr,"")):(f=e.utils.getByClass(d,h,!0),f&&(f.innerHTML=""))}return d},i=function(){for(var s=e.list.childNodes,u=0,d=s.length;u<d;u++)if(s[u].data===void 0)return s[u].cloneNode(!0)},o=function(s){if(typeof s=="string"){if(/<tr[\s>]/g.exec(s)){var u=document.createElement("tbody");return u.innerHTML=s,u.firstElementChild}else if(s.indexOf("<")!==-1){var d=document.createElement("div");return d.innerHTML=s,d.firstElementChild}}},l=function(s){for(var u=0,d=e.valueNames.length;u<d;u++){var m=e.valueNames[u];if(m.data){for(var p=m.data,f=0,h=p.length;f<h;f++)if(p[f]===s)return{data:s}}else{if(m.attr&&m.name&&m.name==s)return m;if(m===s)return s}}},c=function(s,u,d){var m=void 0,p=l(u);!p||(p.data?s.elm.setAttribute("data-"+p.data,d):p.attr&&p.name?(m=e.utils.getByClass(s.elm,p.name,!0),m&&m.setAttribute(p.attr,d)):(m=e.utils.getByClass(s.elm,p,!0),m&&(m.innerHTML=d)))};this.get=function(s,u){n.create(s);for(var d={},m=0,p=u.length;m<p;m++){var f=void 0,h=u[m];if(h.data)for(var v=0,_=h.data.length;v<_;v++)d[h.data[v]]=e.utils.getAttribute(s.elm,"data-"+h.data[v]);else h.attr&&h.name?(f=e.utils.getByClass(s.elm,h.name,!0),d[h.name]=f?e.utils.getAttribute(f,h.attr):""):(f=e.utils.getByClass(s.elm,h,!0),d[h]=f?f.innerHTML:"")}return d},this.set=function(s,u){if(!n.create(s))for(var d in u)u.hasOwnProperty(d)&&c(s,d,u[d])},this.create=function(s){return s.elm!==void 0?!1:(s.elm=t(s.values()),n.set(s,s.values()),!0)},this.remove=function(s){s.elm.parentNode===e.list&&e.list.removeChild(s.elm)},this.show=function(s){n.create(s),e.list.appendChild(s.elm)},this.hide=function(s){s.elm!==void 0&&s.elm.parentNode===e.list&&e.list.removeChild(s.elm)},this.clear=function(){if(e.list.hasChildNodes())for(;e.list.childNodes.length>=1;)e.list.removeChild(e.list.firstChild)},r()};Ke.exports=function(e){return new Gt(e)}});var Ye=b((kr,Je)=>{Je.exports=function(e){var t,n,r,a,i,o={resetList:function(){e.i=1,e.templater.clear(),i=void 0},setOptions:function(s){s.length==2&&s[1]instanceof Array?r=s[1]:s.length==2&&typeof s[1]=="function"?(r=void 0,i=s[1]):s.length==3?(r=s[1],i=s[2]):r=void 0},setColumns:function(){e.items.length!==0&&r===void 0&&(r=e.searchColumns===void 0?o.toArray(e.items[0].values()):e.searchColumns)},setSearchString:function(s){s=e.utils.toString(s).toLowerCase(),s=s.replace(/[-[\]{}()*+?.,\\^$|#]/g,"\\$&"),a=s},toArray:function(s){var u=[];for(var d in s)u.push(d);return u}},l={list:function(){for(var s=[],u,d=a;(u=d.match(/"([^"]+)"/))!==null;)s.push(u[1]),d=d.substring(0,u.index)+d.substring(u.index+u[0].length);d=d.trim(),d.length&&(s=s.concat(d.split(/\s+/)));for(var m=0,p=e.items.length;m<p;m++){var f=e.items[m];if(f.found=!1,!!s.length){for(var h=0,v=s.length;h<v;h++){for(var _=!1,x=0,w=r.length;x<w;x++){var y=f.values(),A=r[x];if(y.hasOwnProperty(A)&&y[A]!==void 0&&y[A]!==null){var M=typeof y[A]!="string"?y[A].toString():y[A];if(M.toLowerCase().indexOf(s[h])!==-1){_=!0;break}}}if(!_)break}f.found=_}}},reset:function(){e.reset.search(),e.searched=!1}},c=function(s){return e.trigger("searchStart"),o.resetList(),o.setSearchString(s),o.setOptions(arguments),o.setColumns(),a===""?l.reset():(e.searched=!0,i?i(a,r):l.list()),e.update(),e.trigger("searchComplete"),e.visibleItems};return e.handlers.searchStart=e.handlers.searchStart||[],e.handlers.searchComplete=e.handlers.searchComplete||[],e.utils.events.bind(e.utils.getByClass(e.listContainer,e.searchClass),"keyup",e.utils.events.debounce(function(s){var u=s.target||s.srcElement,d=u.value===""&&!e.searched;d||c(u.value)},e.searchDelay)),e.utils.events.bind(e.utils.getByClass(e.listContainer,e.searchClass),"input",function(s){var u=s.target||s.srcElement;u.value===""&&c("")}),c}});var Xe=b((Fr,Ve)=>{Ve.exports=function(e){return e.handlers.filterStart=e.handlers.filterStart||[],e.handlers.filterComplete=e.handlers.filterComplete||[],function(t){if(e.trigger("filterStart"),e.i=1,e.reset.filter(),t===void 0)e.filtered=!1;else{e.filtered=!0;for(var n=e.items,r=0,a=n.length;r<a;r++){var i=n[r];t(i)?i.filtered=!0:i.filtered=!1}}return e.update(),e.trigger("filterComplete"),e.visibleItems}}});var et=b((Qr,Ze)=>{Ze.exports=function(e){var t={els:void 0,clear:function(){for(var r=0,a=t.els.length;r<a;r++)e.utils.classes(t.els[r]).remove("asc"),e.utils.classes(t.els[r]).remove("desc")},getOrder:function(r){var a=e.utils.getAttribute(r,"data-order");return a=="asc"||a=="desc"?a:e.utils.classes(r).has("desc")?"asc":e.utils.classes(r).has("asc")?"desc":"asc"},getInSensitive:function(r,a){var i=e.utils.getAttribute(r,"data-insensitive");i==="false"?a.insensitive=!1:a.insensitive=!0},setOrder:function(r){for(var a=0,i=t.els.length;a<i;a++){var o=t.els[a];if(e.utils.getAttribute(o,"data-sort")===r.valueName){var l=e.utils.getAttribute(o,"data-order");l=="asc"||l=="desc"?l==r.order&&e.utils.classes(o).add(r.order):e.utils.classes(o).add(r.order)}}}},n=function(){e.trigger("sortStart");var r={},a=arguments[0].currentTarget||arguments[0].srcElement||void 0;a?(r.valueName=e.utils.getAttribute(a,"data-sort"),t.getInSensitive(a,r),r.order=t.getOrder(a)):(r=arguments[1]||r,r.valueName=arguments[0],r.order=r.order||"asc",r.insensitive=typeof r.insensitive=="undefined"?!0:r.insensitive),t.clear(),t.setOrder(r);var i=r.sortFunction||e.sortFunction||null,o=r.order==="desc"?-1:1,l;i?l=function(c,s){return i(c,s,r)*o}:l=function(c,s){var u=e.utils.naturalSort;return u.alphabet=e.alphabet||r.alphabet||void 0,!u.alphabet&&r.insensitive&&(u=e.utils.naturalSort.caseInsensitive),u(c.values()[r.valueName],s.values()[r.valueName])*o},e.items.sort(l),e.update(),e.trigger("sortComplete")};return e.handlers.sortStart=e.handlers.sortStart||[],e.handlers.sortComplete=e.handlers.sortComplete||[],t.els=e.utils.getByClass(e.listContainer,e.sortClass),e.utils.events.bind(t.els,"click",n),e.on("searchStart",t.clear),e.on("filterStart",t.clear),n}});var rt=b((Ur,tt)=>{tt.exports=function(e,t,n){var r=n.location||0,a=n.distance||100,i=n.threshold||.4;if(t===e)return!0;if(t.length>32)return!1;var o=r,l=function(){var O={},S;for(S=0;S<t.length;S++)O[t.charAt(S)]=0;for(S=0;S<t.length;S++)O[t.charAt(S)]|=1<<t.length-S-1;return O}();function c(O,S){var ge=O/t.length,ve=Math.abs(o-S);return a?ge+ve/a:ve?1:ge}var s=i,u=e.indexOf(t,o);u!=-1&&(s=Math.min(c(0,u),s),u=e.lastIndexOf(t,o+t.length),u!=-1&&(s=Math.min(c(0,u),s)));var d=1<<t.length-1;u=-1;for(var m,p,f=t.length+e.length,h,v=0;v<t.length;v++){for(m=0,p=f;m<p;)c(v,o+p)<=s?m=p:f=p,p=Math.floor((f-m)/2+m);f=p;var _=Math.max(1,o-p+1),x=Math.min(o+p,e.length)+t.length,w=Array(x+2);w[x+1]=(1<<v)-1;for(var y=x;y>=_;y--){var A=l[e.charAt(y-1)];if(v===0?w[y]=(w[y+1]<<1|1)&A:w[y]=(w[y+1]<<1|1)&A|((h[y+1]|h[y])<<1|1)|h[y+1],w[y]&d){var M=c(v,y-1);if(M<=s)if(s=M,u=y-1,u>o)_=Math.max(1,2*o-u);else break}}if(c(v+1,o)>s)break;h=w}return!(u<0)}});var at=b((Hr,nt)=>{var Gr=G(),Ht=U(),Bt=X(),zt=te(),Kt=V(),Wt=rt();nt.exports=function(e,t){t=t||{},t=Bt({location:0,distance:100,threshold:.4,multiSearch:!0,searchClass:"fuzzy-search"},t);var n={search:function(r,a){for(var i=t.multiSearch?r.replace(/ +$/,"").split(/ +/):[r],o=0,l=e.items.length;o<l;o++)n.item(e.items[o],a,i)},item:function(r,a,i){for(var o=!0,l=0;l<i.length;l++){for(var c=!1,s=0,u=a.length;s<u;s++)n.values(r.values(),a[s],i[l])&&(c=!0);c||(o=!1)}r.found=o},values:function(r,a,i){if(r.hasOwnProperty(a)){var o=zt(r[a]).toLowerCase();if(Wt(o,i,t))return!0}return!1}};return Ht.bind(Kt(e.listContainer,t.searchClass),"keyup",e.utils.events.debounce(function(r){var a=r.target||r.srcElement;e.search(a.value,n.search)},e.searchDelay)),function(r,a){e.search(r,a,n.search)}}});var ae=b((Br,ot)=>{var Jt=Ie(),it=V(),Yt=X(),st=Z(),Vt=U(),Xt=te(),Zt=G(),er=De(),tr=ee();ot.exports=function(e,t,n){var r=this,a,i=ne()(r),o=Qe()(r),l=He()(r);a={start:function(){r.listClass="list",r.searchClass="search",r.sortClass="sort",r.page=1e4,r.i=1,r.items=[],r.visibleItems=[],r.matchingItems=[],r.searched=!1,r.filtered=!1,r.searchColumns=void 0,r.searchDelay=0,r.handlers={updated:[]},r.valueNames=[],r.utils={getByClass:it,extend:Yt,indexOf:st,events:Vt,toString:Xt,naturalSort:Jt,classes:Zt,getAttribute:er,toArray:tr},r.utils.extend(r,t),r.listContainer=typeof e=="string"?document.getElementById(e):e,!!r.listContainer&&(r.list=it(r.listContainer,r.listClass,!0),r.parse=ze()(r),r.templater=We()(r),r.search=Ye()(r),r.filter=Xe()(r),r.sort=et()(r),r.fuzzySearch=at()(r,t.fuzzySearch),this.handlers(),this.items(),this.pagination(),r.update())},handlers:function(){for(var c in r.handlers)r[c]&&r.handlers.hasOwnProperty(c)&&r.on(c,r[c])},items:function(){r.parse(r.list),n!==void 0&&r.add(n)},pagination:function(){if(t.pagination!==void 0){t.pagination===!0&&(t.pagination=[{}]),t.pagination[0]===void 0&&(t.pagination=[t.pagination]);for(var c=0,s=t.pagination.length;c<s;c++)l(t.pagination[c])}}},this.reIndex=function(){r.items=[],r.visibleItems=[],r.matchingItems=[],r.searched=!1,r.filtered=!1,r.parse(r.list)},this.toJSON=function(){for(var c=[],s=0,u=r.items.length;s<u;s++)c.push(r.items[s].values());return c},this.add=function(c,s){if(c.length!==0){if(s){o(c.slice(0),s);return}var u=[],d=!1;c[0]===void 0&&(c=[c]);for(var m=0,p=c.length;m<p;m++){var f=null;d=r.items.length>r.page,f=new i(c[m],void 0,d),r.items.push(f),u.push(f)}return r.update(),u}},this.show=function(c,s){return this.i=c,this.page=s,r.update(),r},this.remove=function(c,s,u){for(var d=0,m=0,p=r.items.length;m<p;m++)r.items[m].values()[c]==s&&(r.templater.remove(r.items[m],u),r.items.splice(m,1),p--,m--,d++);return r.update(),d},this.get=function(c,s){for(var u=[],d=0,m=r.items.length;d<m;d++){var p=r.items[d];p.values()[c]==s&&u.push(p)}return u},this.size=function(){return r.items.length},this.clear=function(){return r.templater.clear(),r.items=[],r},this.on=function(c,s){return r.handlers[c].push(s),r},this.off=function(c,s){var u=r.handlers[c],d=st(u,s);return d>-1&&u.splice(d,1),r},this.trigger=function(c){for(var s=r.handlers[c].length;s--;)r.handlers[c][s](r);return r},this.reset={filter:function(){for(var c=r.items,s=c.length;s--;)c[s].filtered=!1;return r},search:function(){for(var c=r.items,s=c.length;s--;)c[s].found=!1;return r}},this.update=function(){var c=r.items,s=c.length;r.visibleItems=[],r.matchingItems=[],r.templater.clear();for(var u=0;u<s;u++)c[u].matching()&&r.matchingItems.length+1>=r.i&&r.visibleItems.length<r.page?(c[u].show(),r.visibleItems.push(c[u]),r.matchingItems.push(c[u])):(c[u].matching()&&r.matchingItems.push(c[u]),c[u].hide());return r.trigger("updated"),r},a.start()}});var D=class{constructor(){g(this,"queue",new Set)}putInQueue(t){this.getId(t)<0||(document.querySelector(`#action-area-${this.getId(t)} .spinner`).classList.add("is-active"),document.querySelector(`#action-area-${this.getId(t)} .error-icon`).classList.remove("error-icon-visible"),this.queue.add(t))}getId(t){return t.parentElement.querySelector(".action_number").innerText-1}checkQueue(){return E(this,null,function*(){for(let t of this.queue)yield this.loadActionParams(t)})}loadActionParams(t){return E(this,null,function*(){if(!t.value.length)return;let n=yield fetch(ShopMagic.ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"shopmagic_load_action_params",action_slug:t.value,action_id:this.getId(t),post:document.getElementById("post_ID").value,editor_initialized:window.SM_EditorInitialized===!0,paramProcessNonce:ShopMagic.paramProcessNonce})});if(n.ok){let r=yield n.json();jQuery(`#action-config-area-${this.getId(t)}`).html(r.action_box)}else document.querySelector(`#action-area-${this.getId(t)} .error-icon`).classList.add("error-icon-visible");document.querySelector(`#action-area-${this.getId(t)} .spinner`).classList.remove("is-active")})}};var J=new D,ye=(e,t,n,r=["id","class","name","for"])=>{function a(i,o){let l=i.getAttribute(o).replace(t,n);i.setAttribute(o,l)}r.forEach(i=>{e.getAttribute(i)&&a(e,i),e.querySelectorAll(`[${i}*='${t}']`).forEach(o=>{a(o,i)})})},be=e=>{let t=e.currentTarget.getAttribute("id").split("_")[3];jQuery(`#_action_title_${t}`).text(e.currentTarget.value)},_e=e=>{e.stopPropagation()},Ot=e=>{let t=e.closest(".sm-actions-wrap");return e.closest(".action-form-table").remove(),t.querySelectorAll('[id^="action-area"]').forEach((n,r)=>{ye(n,r,r-1),n.querySelector(".action_number").innerText=r}),!1},Nt=()=>{function e(){return document.querySelectorAll('[id^="action-area"]').length-1}let t=document.getElementById("action-area-stub").cloneNode(!0);t.id=`action-area-${e()}`,t.querySelector("#action-config-area-stub").id=`action-config-area-${e()}`;let n=t.querySelector("#_action_stub");n.id=`_actions_${e()}_action`,n.name=`actions[${e()}][_action]`;let r=t.querySelector(".action_main_select");r.addEventListener("change",o=>{o.stopPropagation(),J.loadActionParams(o.currentTarget)}),r.addEventListener("click",_e),t.querySelector(".action_number").innerHTML=e()+1,t.querySelector("#_action_title_stub").id=`_action_title_${e()}`;let a=t.querySelector("#action_title_label_stub");a.id=`action_title_label${e()}_action`,a.for=`action_title_input_${e()}`;let i=t.querySelector("#action_title_stub");return i.id=`action_title_input_${e()}`,i.name=`actions[${e()}][_action_title]`,i.addEventListener("input",be),ye(t,"occ",e()),jQuery(t).insertAfter(".action-form-table:last"),document.dispatchEvent(new CustomEvent("sm:actionadded")),!1},Ee=()=>{document.querySelectorAll(".action_main_select").forEach(e=>{J.putInQueue(e),e.addEventListener("input",_e)}),J.checkQueue(),document.querySelectorAll(".action_title_input").forEach(e=>{e.addEventListener("input",be)})},we=e=>{var i,o;let t=l=>{let c=document.getElementById("field-multiple-row").content.firstElementChild.cloneNode(!0);we(c),l.parentNode.insertBefore(c,l.nextSibling)},n=l=>l.remove(),r=l=>l.closest(".js-clone-wrapper"),a=()=>{let l=document.querySelectorAll("table .shopmagic-field--multiple label");requestAnimationFrame(()=>{l.forEach((c,s)=>{c.innerText=String.fromCharCode("A".charCodeAt()+s)})})};(i=e.querySelector(".add-field"))==null||i.addEventListener("click",l=>{t(r(l.currentTarget)),a()}),(o=e.querySelector(".remove-field"))==null||o.addEventListener("click",l=>{n(r(l.currentTarget)),a()})},Se=()=>{window.addNewAction=Nt,window.removeAction=Ot,window.attachAddAndRemove=we};var{__:Pt}=wp.i18n,Y=class extends Error{constructor(t){super(t);this.message=t,this.name="AttachmentMimeError"}},xe=class{constructor(t,n){g(this,"SUPPORTED_MIMES",ShopMagic.supportedMimes);g(this,"bindEvents",()=>{this.addAttachmentEl.addEventListener("click",this.selectMedia),this.attachmentsList.querySelectorAll(".js-remove-attachment").forEach(t=>{t.addEventListener("click",this.removeAttachment)})});g(this,"selectMedia",t=>{t.preventDefault(),this.maybeRemoveErrorMessage(),this.frame||this.initializeFrame(),this.frame.open()});g(this,"initializeFrame",()=>{this.frame=wp.media({multiple:!0}),this.frame.on("select",()=>{try{this.selectAttachment()}catch(t){if(t instanceof Y)this.showErrorMessage(t);else throw t}})});g(this,"selectAttachment",()=>{this.frame.state().get("selection").toJSON().forEach(n=>{let{mime:r,url:a,filename:i}=n;if(!this.SUPPORTED_MIMES.includes(r))throw new Y(Pt("Currently, only PDF attachments are supported.","shopmagic-for-woocommerce"));this.mediaContainerEl.insertAdjacentElement("afterbegin",this.createInputElement(a)),this.attachmentsList.insertAdjacentElement("beforeend",this.createAttachmentElement(a,i))})});g(this,"createInputElement",t=>{let n=document.createElement("input");return n.type="hidden",n.value=t,n.name=this.valueIdentifier,n});g(this,"removeAttachment",t=>{t.preventDefault();let n=t.currentTarget,r=n.nextElementSibling.getAttribute("href");n.parentElement.remove(),this.mediaContainerEl.querySelector(`[value="${r}"]`).remove()});g(this,"showErrorMessage",t=>{let n=document.createElement("p"),r=document.createTextNode(t.message);n.appendChild(r);let a=document.createElement("div");a.classList.add("notice","notice-error","is-dismissible");let i=document.createElement("button");i.classList.add("notice-dismiss"),i.addEventListener("click",o=>{o.preventDefault(),window.makeNoticeDismissible(i)}),a.appendChild(n),a.appendChild(i),this.mediaContainerEl.insertAdjacentElement("beforeend",a)});g(this,"maybeRemoveErrorMessage",()=>{let t=this.mediaContainerEl.querySelector(".shopmagic-error");t&&t.remove()});this.mediaContainerEl=document.getElementById(t),this.valueIdentifier=n,this.addAttachmentEl=this.mediaContainerEl.querySelector(".js-add-attachment"),this.attachmentsList=this.mediaContainerEl.querySelector(".js-attachments-container")}createAttachmentElement(t,n){let r=document.createElement("p"),a=document.createElement("a");a.setAttribute("href","#"),a.classList.add("js-remove-attachment","shopmagic-remove-attachment-button"),a.insertAdjacentText("afterbegin","\u2715"),a.addEventListener("click",this.removeAttachment);let i=document.createElement("a"),o=document.createTextNode(n);return i.setAttribute("href",t),i.setAttribute("target","_blank"),i.appendChild(o),r.appendChild(a),r.appendChild(i),r}},Ae=(e,t)=>new xe(e,t).bindEvents();var dt=Lt(ae());var{__:T}=wp.i18n,ct=`
<div class="import-automation">
  <p class="import-help">${T("If you have an automation in JSON format, you can import it by submitting the form below.","shopmagic-for-woocommerce")}</p>
  <form id="automation-import-form" method="POST" class="import-upload-form" enctype="multipart/form-data">
    <label class="screen-reader-text" for="importfile">${T("JSON file to import","shopmagic-for-woocommerce")}</label>
    <input id="importfile" name="automations-json" type="file" accept="application/json">
    <input class="button" type="submit" value="${T("Import","shopmagic-for-woocommerce")}">
  </form>
</div>`,lt=`
<div class="filters-group">
    <div class="filter-field-select"></div>
    <div class="filter-fields"></div>
    <div class="filter-buttons">
        <button class="button filter-add-and">${T("and","shopmagic-for-woocommerce")}</button>
        <button class="filter-remove" title="${T("remove","shopmagic-for-woocommerce")}">&ndash;</button>
    </div>
</div>`,ie=(e,t)=>`
<div class="notice notice-${e} is-dismissible">
  <p>${t}</p>
  <button type="button" class="notice-dismiss" onclick="window.makeNoticeDismissible(this)"><span class="screen-reader-text">${T("Hide message","shopmagic-for-woocommerce")}</span></button>
</div>`;function L(e){let{body:t}=new DOMParser().parseFromString(e,"text/html");return t.firstChild.cloneNode(!0)}var H=class{constructor(t,n="",r=0,a={}){g(this,"filter",null);g(this,"$container",null);this.$container=t,this.translations=a,this.groupNumber=n,this.ruleNumber=r}afterRenderHook(){}prepareHtmlField(t){let n=function(a,i){for(let o in i)if(i.hasOwnProperty(o)){let l=i[o];a.append(`<option value="${o}">${l}</option>`)}},r;switch(t.template){case"select":r=jQuery("<select />"),n(r,t.options);break;case"woo-select":r=jQuery("<select />"),r.prop("multiple",!0),r.addClass("wc-enhanced-select"),n(r,t.options);let a=this.afterRenderHook;this.afterRenderHook=function(){jQuery(document.body).trigger("wc-enhanced-select-init"),a()};break;case"product-select":r=jQuery("<select />").addClass("wc-product-search").data("action","woocommerce_json_search_products_and_variations").data("placeholder",t.placeholder),n(r,t.options);let i=this.afterRenderHook;this.afterRenderHook=function(o){return function(){let l=o.data("preval");if(l){for(let c in l)if(l.hasOwnProperty(c)){let s=jQuery("<option />");s.attr("selected","selected").val(l[c]).html(c),o.append(s)}}jQuery(document.body).trigger("wc-enhanced-select-init"),i()}}(r);break;case"input-date-picker":r=jQuery('<input type="text" />').addClass("date-picker").datepicker({dateFormat:"yy-mm-dd",showOtherMonths:!0,selectOtherMonths:!0,showButtonPanel:!0});break;case"paragraph":return jQuery(`<p>${t.description}</p>`);case"pro-event-info":return r=jQuery(`${t.description}`),r.addClass(`${t.class}`),r;default:r=jQuery('<input type="text" />')}return t.disabled&&r.prop("disabled",!0),t.readonly&&r.prop("readonly",!0),t.multiple?(r.attr("name",`${this.generateFieldName(t.name)}[]`),r.prop("multiple",!0)):r.attr("name",this.generateFieldName(t.name)),t.placeholder&&r.prop("placeholder",t.placeholder),t.label&&r.prepend(jQuery(`<label>${t.label}</label>`)),r}generateFieldName(t){return`_filters[${[this.groupNumber,this.ruleNumber,t].join("][")}]`}renderSelectFilterField(t){let n=jQuery("<select />");n.attr("name",this.generateFieldName("filter_slug"));let r=null,a=null;t.forEach(i=>{let o=jQuery("<option />").val(i.id).html(i.name).data("filter",i);i.group!==r&&(a!==null&&n.append(a),r=i.group,a=jQuery("<optgroup />").attr("label",r)),a.append(o)}),a!==null&&n.append(a),n.change(i=>{let o=jQuery(i.target).find(":selected").data("filter");this.renderFields(o)}),this.$container.find(".filter-field-select").append(n)}setFilterData(t=null){let n=this.$container.find(`.filter-field-select select option[value=${t.filter_slug}]`);if(n.length>0){n.attr("selected","selected");let r=n.data("filter");this.renderFields(r,t.data)}}renderFields(t,n=null){this.filter=t,this.afterRenderHook=function(){};let r=this.$container.find(".filter-fields");r.empty(),this.filter.fields&&this.filter.fields.forEach(a=>{let i=this.prepareHtmlField(a);n&&n.hasOwnProperty(a.name)&&(i.val(n[a.name]),i.data("preval",n[a.name])),r.append(i),i.wrap('<div class="field"></div>')}),this.afterRenderHook()}};var{__:ut}=wp.i18n,oe=class{constructor(t,n={}){g(this,"ADD_GROUP_BUTTON_ID","#add-filter-group");g(this,"FILTER_GROUP_CONTAINER_ID","#filter-group-area");g(this,"UNIQUE_ID_COUNTER",0);this.possibleFilters=t,this.translations=n,this.possibleFilters.unshift({id:"",name:ut("Select filter","shopmagic-for-woocommerce")})}static cacheExistingFilters(t){Object.keys(t).length>0&&(this.existingFilters=t)}attachEvents(){jQuery(this.FILTER_GROUP_CONTAINER_ID).empty(),jQuery(this.ADD_GROUP_BUTTON_ID).toggle(this.possibleFilters.length>1).unbind().click(t=>{t.preventDefault(),this.renderNewGroup()})}renderExistingFilters(t){if(!t)return;let n,r,a=Object.prototype.hasOwnProperty;Object.entries(t).forEach(([i,o])=>{a.call(t,i)&&Object.entries(o).forEach(([l,c])=>{a.call(o,l)&&this.isSupportedFilter(c.filter_slug)&&(n!==i?(n=i,r=this.renderNewGroup(c)):this.renderInnerGroup(r,c))})})}renderNewGroup(t=null){let n=jQuery(this.prepareFilterGroupTemplate());this.UNIQUE_ID_COUNTER+=1,n.data("groupId",this.UNIQUE_ID_COUNTER);let r=jQuery(this.FILTER_GROUP_CONTAINER_ID);return r.find(".filters-group").length>0&&r.append(`<div class="filters-group-or"><span>${ut("or","shopmagic-for-woocommerce")}</span></div>`),r.append(n),this.UNIQUE_ID_COUNTER+=1,this.renderFilterElement(n,n.data("groupId"),this.UNIQUE_ID_COUNTER,t),n}prepareFilterGroupTemplate(){let t=L(lt);return t.querySelector(".filter-remove").addEventListener("click",n=>{n.preventDefault();let r=n.currentTarget;oe.removeGroup(r.closest(".filters-group"))}),t.querySelector(".filter-add-and").addEventListener("click",n=>{n.preventDefault();let r=n.currentTarget;this.renderInnerGroup(jQuery(r.closest(".filters-group")))}),t}renderInnerGroup(t,n=null){let r=jQuery(this.prepareFilterGroupTemplate());r.data("groupId",t.data("groupId")),t.after(r),this.UNIQUE_ID_COUNTER+=1,this.renderFilterElement(r,r.data("groupId"),this.UNIQUE_ID_COUNTER,n)}renderFilterElement(t,n,r,a=null){let i=new H(t,n,r,this.translations);i.renderSelectFilterField(this.possibleFilters),a&&i.setFilterData(a)}static removeGroup(t){let{nextElementSibling:n}=t;n&&n.matches(".filters-group-or")&&n.remove(),t.remove()}isSupportedFilter(t){return Object.values(this.possibleFilters).find(n=>n.id===t)}},$=oe;g($,"existingFilters",null);function se(e,t){$.cacheExistingFilters(t);let n=new $(e,ShopMagic);return n.attachEvents(),n.renderExistingFilters($.existingFilters),n}var B=class{constructor(t){g(this,"UTM_PARAMETERS",["utm_source","utm_medium","utm_campaign","utm_content","utm_term"]);this.fields=t[0].querySelectorAll("input")}cacheAll(){this.fields.forEach(t=>{this.isUtmParameter(t)&&this.cache(t)})}loadAll(){this.fields.forEach(t=>{this.isUtmParameter(t)&&this.load(t)})}cache(t){localStorage.setItem(t.id,t.value)}load(t){t.value=localStorage.getItem(t.id)}isUtmParameter(t){return this.UTM_PARAMETERS.indexOf(t.id)!==-1}};var z=class{constructor(t){g(this,"WP_ACTION_DIALOG_RENDER","shopmagic_placeholder_dialog");g(this,"STRING_RESULT_SELECTOR","#placeholder_result");g(this,"STRING_COPY_SELECTOR","#copy_placeholder_result");g(this,"$DIALOG_HANDLE",null);this.slug=t}show(){return E(this,null,function*(){if(this.$DIALOG_HANDLE===null){let t=new URLSearchParams({action:this.WP_ACTION_DIALOG_RENDER,slug:this.slug,event_data:jQuery("#shopmagic_event_metabox [name^='event']").serialize()}),n=`${ajaxurl}?${t}`,a=yield(yield fetch(n)).text();yield this.render(a)}})}render(t){return E(this,null,function*(){this.$DIALOG_HANDLE=jQuery(t).dialog({modal:!0,draggable:!1,resizable:!1,width:560,autoOpen:!1,closeOnEscape:!0,classes:{"ui-dialog":"placeholder-dialog"},close:this.destroy.bind(this)});let n=new B(this.$DIALOG_HANDLE);this.$DIALOG_HANDLE.on("dialogopen",()=>n.loadAll()),this.$DIALOG_HANDLE.on("dialogbeforeclose",()=>n.cacheAll()),this.$DIALOG_HANDLE.dialog("open"),this.runStringGenerator()})}generatePlaceholderString(t){let n=t.map((a,i)=>{let o=jQuery(i).attr("name").toString().replace(/[\[\]]/g,""),l=jQuery(i).val()?jQuery(i).val().toString():"";return l.length>0?`${o}: '${l}'`:""}).toArray().filter(a=>a.length>0).join(", "),r=`{{ ${this.slug} }}`;n.length>0&&(r=`{{ ${this.slug} | ${n} }}`),jQuery(this.$DIALOG_HANDLE).find(this.STRING_RESULT_SELECTOR).val(r)}runStringGenerator(){let t=jQuery(this.$DIALOG_HANDLE).find("select, input").not('input[type="checkbox"]').not(this.STRING_RESULT_SELECTOR);this.generatePlaceholderString(t),t.keyup(n=>{n.preventDefault(),this.generatePlaceholderString(t)}).change(n=>{n.preventDefault(),this.generatePlaceholderString(t)}),jQuery(this.$DIALOG_HANDLE).find(this.STRING_COPY_SELECTOR).click(n=>{n.preventDefault(),this.copyResultToClipboard(),this.$DIALOG_HANDLE.dialog("close"),this.destroy()})}copyResultToClipboard(){let t=jQuery(this.$DIALOG_HANDLE).find(this.STRING_RESULT_SELECTOR).get(0);t.select(),t.setSelectionRange(0,99999),document.execCommand("copy")}destroy(){jQuery(this.$DIALOG_HANDLE).empty().remove()}};function rr(e){let t=document.getElementById("placeholders"),n={searchClass:"search",valueNames:["placeholder",{name:"dialog_slug",attr:"data-dialog-slug"}],item:'<li><span class="placeholder title dialog_slug" data-dialog-slug=""></span></li>'};t.querySelector(".list").innerHTML="",new dt.default("placeholders",n,e),t.querySelectorAll("li").forEach(r=>{r.addEventListener("click",a=>E(this,null,function*(){a.preventDefault();let i=r.querySelector(".dialog_slug").dataset.dialogSlug;yield new z(i).show()}))}),jQuery("#shopmagic_placeholders_metabox").show()}function nr(){let e=jQuery("#event-config-area [name=event\\[manual\\]]").val()==="manual";jQuery("#shopmagic_manual_actions_metabox").toggle(e)}function ar(e){return E(this,null,function*(){return fetch(ShopMagic.ajaxurl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"shopmagic_load_event_params",event_slug:e,post:jQuery("#post_ID").val(),paramProcessNonce:ShopMagic.paramProcessNonce})})})}function ir(e){jQuery("#event-config-area").html(e.event_box),jQuery("#event-desc-area .content").html(e.description),rr(e.placeholders),nr(),se(e.filters,e.existing_filters)}function ce(){return E(this,null,function*(){let e=document.getElementById("_event"),t=document.getElementById("shopmagic_event_metabox");if(e.value.length){t.querySelector(".spinner").classList.add("is-active"),t.querySelector(".error-icon").classList.remove("error-icon-visible");try{let n=yield ar(e.value);n.ok?ir(yield n.json()):jQuery("#shopmagic_placeholders_metabox").hide()}catch(n){t.querySelector(".error-icon").classList.add("error-icon-visible")}finally{t.querySelector(".spinner").classList.remove("is-active")}}})}var{__:sr}=wp.i18n,K=class{constructor(){g(this,"importContainer");g(this,"prepareTemplate",()=>{this.appendToDom(this.createActionLink(),this.createImportForm())});g(this,"createActionLink",()=>{let t=this.titleAction.cloneNode(!1);return t.href="#",t.innerText=sr("Import","shopmagic-for-woocommerce"),t.addEventListener("click",this.toggleImportForm),t});g(this,"createImportForm",()=>{let t=document.createElement("div");return t.appendChild(L(ct)),t.querySelector("#automation-import-form").addEventListener("submit",this.processFormSubmit),this.importContainer=t,t});g(this,"appendToDom",(...t)=>{let n=new DocumentFragment;n.append(...t),this.titleAction.parentNode.insertBefore(n,this.titleAction.nextSibling)});g(this,"processFormSubmit",t=>E(this,null,function*(){t.preventDefault();let n=new FormData(t.target);n.set("action","shopmagic_import_automation"),n.set("security",ShopMagic.importNonce);try{let a=yield(yield fetch(ShopMagic.ajaxurl,{method:"POST",body:n})).json();a.success?(this.showSuccessNotice(a.data),setTimeout(()=>{window.location.reload()},2e3)):this.showErrorNotice(a.data)}catch(r){this.showErrorNotice(r.message)}}));g(this,"showSuccessNotice",t=>{this.importContainer.insertAdjacentElement("beforebegin",L(ie("success",t)))});g(this,"showErrorNotice",t=>{this.importContainer.insertAdjacentElement("beforebegin",L(ie("error",t)))});g(this,"toggleImportForm",t=>{t.preventDefault(),this.importContainer.firstElementChild.classList.toggle("show-import-form")});this.titleAction=document.getElementsByClassName("page-title-action")[0]}};var le=class{constructor(){this.id="0";this.name=!0;this.labels=!0;this.doubleOptin=!1;this.agreement=""}},W=class{constructor(t){this.updateShortcode=t=>{t.type==="checkbox"?this.shortcode[mt(t)]=t.checked:this.shortcode[mt(t)]=t.value};let n=document.getElementById(t);if(!n)throw new Error("Invalid element reference");this.container=n;let r=this.container.querySelector('output[name="shortcode"]');if(!r)throw new Error("Container has no <output> element");this.output=r,this.controls=this.container.querySelectorAll("input, textarea"),this.shortcode=ur(this.output.innerText)}initialize(){this.controls.forEach(t=>{this.updateShortcode(t),t.addEventListener("change",()=>{this.updateShortcode(t),this.renderShortcode()})}),this.renderShortcode()}renderShortcode(){this.output.innerText=dr(this.shortcode)}};function mt(e){return e.name.replace(/^_form_shortcode\[(.+)]$/,"$1")}function or(e){return t=>t==="id"||t==="agreement"?cr(t,e):lr(t,e)}function cr(e,t){let n=t.match(new RegExp(` ${e}="(.+?)"`));if(n===null)return{[e]:""};let[,r=""]=n;return{[e]:r}}function lr(e,t){var a;let n=t.match(new RegExp(` ${e}=?(true|false)?`));if(n===null)return{[e]:((a=Object.getOwnPropertyDescriptor(new le,e))==null?void 0:a.value)||!1};let[,r="true"]=n;return{[e]:r==="true"}}function ur(e){let t=or(e),n=new le;for(let r of Object.keys(n))Object.assign(n,t(r));return n}function dr(e){let t="[shopmagic_form";for(let n of Object.keys(e))if(n==="id"||n==="agreement"){if(e[n]==="")continue;t+=` ${n}="${e[n]}"`}else e[n]?t+=` ${n}`:n!=="doubleOptin"&&(t+=` ${n}=false`);return t+="]",t}var mr={In:"opt_in",Out:"opt_out"},ue="shopmagic_form_metabox";function ht(){let e=document.getElementById("type");!e||(new W(ue).initialize(),pt(e),e.addEventListener("change",()=>{pt(e)}))}var pt=e=>{e.value===mr.Out?document.getElementById(ue).style.display="none":document.getElementById(ue).style.display=""};var{__:hr}=wp.i18n,q=class{constructor(e){this.form=e;this.handle=e=>E(this,null,function*(){e.preventDefault(),this.messageBeforeRun();let t=yield fetch(ShopMagic.ajaxurl,{method:"POST",body:new FormData(this.form)});if(!t.ok){this.displayError(hr("Network connection error","shopmagic-for-woocommerce"));return}let n=yield t.json();if(!n.success){this.displayError(n.data.context);return}n=yield this.queueResponse(n),this.showResponse(n)})}init(){this.form.addEventListener("submit",this.handle)}queueResponse(e){return E(this,null,function*(){if(typeof e.data.run=="undefined")return e;let t=new FormData(this.form);t.append("run",e.data.run);let n=yield fetch(ShopMagic.ajaxurl,{method:"POST",body:t});if(n.ok)return yield this.queueResponse(yield n.json())})}displayError(e){this.displayMessage(e,"error")}displaySuccess(e){this.displayMessage(e,"success")}displayMessage(e,t){let n=document.createElement("div");n.classList.add("shopmagic-message",t);let r=document.createElement("p"),a=document.createTextNode(e);r.appendChild(a),n.appendChild(r),this.form.append(n)}showResponse(e){var t;(t=this.form.querySelector(".progress"))==null||t.remove(),typeof e.data.context=="string"&&this.displaySuccess(e.data.context)}messageBeforeRun(){this.form.querySelectorAll(".shopmagic-message").forEach(a=>a.remove());let e=document.createElement("label");e.classList.add("progress","shopmagic-message");let t=document.createElement("progress"),n=document.createTextNode(this.message),r=document.createElement("br");e.append(n,r,t),this.form.append(e)}};var{__:pr}=wp.i18n,de=class extends q{constructor(){super(...arguments);this.message=pr("Exporting subscribers...","shopmagic-for-woocommerce")}showResponse(e){e.data.download&&(window.location.href=e.data.download),super.showResponse(e)}};var{__:fr}=wp.i18n,me=class extends q{constructor(){super(...arguments);this.message=fr("Import in progress...","shopmagic-for-woocommerce")}};var he=(e,t=null)=>{let n=new URLSearchParams(window.location.search);return n.get("post_type")===e&&n.get("page")===t&&window.location.pathname.includes("edit.php")},ft=e=>he(e);function gt(){return ft("shopmagic_automation")}function pe(){return document.getElementById("_shopmagic_edit_page")!==null}function vt(){return ft("shopmagic_list")}function yt(){return he("shopmagic_automation","optins")}function fe(){return he("shopmagic_automation","import-export")}function bt(){return document.getElementById("shopmagic_list_settings_metabox")!==null}function gr(e){let t=document.createElement("div");t.classList.add("tabs","nav-tab-wrapper");let n=document.createElement("ul");return e.forEach(r=>{let a=document.createElement("li");a.classList.add("nav-tab-li"),window.location.pathname+window.location.search===r.link&&a.classList.add("ui-tabs-active");let i=document.createElement("a");i.classList.add("nav-tab"),i.setAttribute("href",r.link),i.appendChild(document.createTextNode(r.name)),a.appendChild(i),n.appendChild(a)}),t.appendChild(n),t}function _t(e,t){let n=gr(t),r=document.createElement("div");r.id="super-duper",vr(e,r),yr(r,n)}function vr(e,t){e.parentNode.appendChild(t),t.appendChild(e)}function yr(e,t){e.insertBefore(t,e.firstChild)}var{__:R}=wp.i18n;ShopMagic.wyswig={init(e){let t=jQuery;if(typeof tinymce=="undefined"||typeof tinyMCEPreInit.mceInit.shopmagic_editor=="undefined")return;let n,r=t.extend({},tinyMCEPreInit.mceInit.shopmagic_editor),a=t.extend({},tinyMCEPreInit.qtInit.shopmagic_editor);if(r.selector=`#${e}`,r.id=e,r.wp_autoresize_on=!1,tinyMCEPreInit.mceInit[r.id]=r,a.id=e,tinymce.$(`#wp-${e}-wrap`).hasClass("tmce-active")||!tinyMCEPreInit.qtInit.hasOwnProperty(e))try{tinymce.init(r)}catch(o){console.log(o)}try{n=quicktags(a),this.init_buttons(n)}catch(o){console.log(o)}},init_buttons(e){let t=",strong,em,link,block,del,ins,img,ul,ol,li,code,more,close,",{name:n}=e,{settings:r}=e,a="",i={},o="";r.buttons&&(o=`,${r.buttons},`);for(let l in edButtons)!edButtons[l]||(id=edButtons[l].id,!(o&&t.indexOf(`,${id},`)!==-1&&o.indexOf(`,${id},`)===-1)&&(!edButtons[l].instance||edButtons[l].instance===inst)&&(i[id]=edButtons[l],edButtons[l].html&&(a+=edButtons[l].html(`${n}_`))));o&&o.indexOf(",fullscreen,")!==-1&&(i.fullscreen=new qt.FullscreenButton,a+=i.fullscreen.html(`${n}_`)),document.getElementsByTagName("html")[0].dir==="rtl"&&(i.textdirection=new qt.TextDirectionButton,a+=i.textdirection.html(`${n}_`)),e.toolbar.innerHTML=a,e.theButtons=i}};ShopMagic.media=(e,t)=>{Ae(e,t)};function br(){let e=jQuery(document.querySelector("div.wrap"));if(e.length>0){let t="automations_tab",n="recipes_tab",r=`<div id="${t}"></div>`,a=jQuery(`<div class="tabs nav-tab-wrapper"><ul><li class="nav-tab-li"><a class="nav-tab" href="#${t}">${R("Automations","shopmagic-for-woocommerce")}</a></li><li class="nav-tab-li nav-tab-recipes"><a class="nav-tab" href="#${n}">${R("Ready-to-use Recipes","shopmagic-for-woocommerce")} <span class="ribbon new">New</span></a></li></ul></div>`);jQuery.get(`${ShopMagic.ajaxurl}?action=shopmagic_recipes_tab`,i=>{e.append(jQuery(`<div id="${n}">${i}</div>`).hide()),e.tabs("refresh")}),e.wrapInner(r).prepend(a).tabs()}}gt()&&(br(),new K().prepareTemplate());if(pe()){let e=document.getElementById("_event");e.addEventListener("change",ce),e.dispatchEvent(new Event("change")),jQuery("#shopmagic_placeholders_metabox").length&&jQuery("#shopmagic_placeholders_metabox").hide(),Ee(),Se()}if(vt()||yt()||fe()){let e=new URL(document.URL).pathname;_t(document.querySelector("div.wrap"),[{name:R("Marketing Lists","shopmagic-for-woocommerce"),link:`${e}?post_type=shopmagic_list`},{name:R("Subscribers","shopmagic-for-woocommerce"),link:`${e}?post_type=shopmagic_automation&page=optins`},{name:R("Import/Export","shopmagic-for-woocommerce"),link:`${e}?post_type=shopmagic_automation&page=import-export`}])}fe()&&(new me(document.forms.namedItem("import")).init(),new de(document.forms.namedItem("export")).init());bt()&&ht();jQuery(e=>{window.makeNoticeDismissible=n=>{let r=jQuery(n).parent();r.fadeTo(100,0,()=>{r.slideUp(100,()=>{r.remove()})})},function(n,r){let a=function(){e(n).tipTip(r)};a(),e(document).ajaxComplete(()=>{a()})}(".shopmagic-help-tip, .woocommerce-help-tip",{attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),pe()&&(window.loadEmailTemplate=function(n){let r=e(`#predefined_block_${n}`).val();return e.ajax({url:ShopMagic.ajaxurl,method:"POST",data:{action:"sm_sea_load_email_template",template_slug:r,paramProcessNonce:ShopMagic.paramProcessNonce},beforeSend(){e(`.email_templates_${n} .spinner`).addClass("is-active"),e(`.email_templates_${n} .error-icon`).removeClass("error-icon-visible")}}).done(a=>{tinymce.execCommand("mceFocus",!1,n),tinymce.activeEditor.execCommand("mceInsertContent",!1,a)}).fail(()=>{e(`.email_templates_${n} .error-icon`).addClass("error-icon-visible")}).always(()=>{e(`.email_templates_${n} .spinner`).removeClass("is-active")}),!1}),function(r){r(()=>{r(".send_test_email").click(function(a){a.preventDefault();let i=r(this).parents(".action-form-table"),o=r(`#${r(this).data("dialog-id")}`),l=r(o).clone().show().dialog({modal:!0,draggable:!1,resizable:!1,width:560,classes:{"ui-dialog":"shopmagic-dialog"},close(){jQuery(l).empty().remove()}});l.find(".test_email_button").click(function(){r(this).attr("disabled",!0),jQuery.post(ajaxurl,{action:`shopmagic_${r(this).data("hook-name")}`,event:r("#_event").val(),email:l.find("input.email_to_test").val(),action_data:r("<form />").append(i.clone()).serialize()},c=>{c.response&&(l.find(".dialog-result").html(c.response),l.find(".test_email_button").attr("disabled",!1)),l.find(".close-dialog").click(s=>{s.preventDefault(),l.dialog("close")})})})})})}(jQuery),function(r){r(()=>{r(".cancel_queue").click(function(a){let i=this;a.preventDefault(),window.confirm(r(this).data("sure"))&&r.post(r(this).attr("href"),o=>{o.result==="OK"&&r(i).parents("tr").fadeOut()})})})}(jQuery),function(r){r("#manual-items-queue-match").each((a,i)=>{let o=r(i),l=o.find(".item-list"),c=parseInt(o.data("count"),10),s=parseInt(o.data("automation-id"),10),u=parseInt(o.data("default-pagesize"),10),d=1,m=[],p=o.find(".queued-progressbar").progressbar({value:0});function f(v){return r.ajax({url:o.data("page-match-url"),data:{page:v,automation_id:s,page_size:u,method:"GET"},success(_){let x=Math.floor(_.data.page*u/c*100);p.progressbar({value:x}),_.data.items.forEach(w=>{l.append(r(w))}),m=m.concat(_.data.ids)},error(_,x,w){o.find(".item-list-counter").text(w)}})}(function v(){let _=Math.ceil(c/u);f(d++).then(()=>{d<=_?v():h()})})();function h(){l.find("li").length===m.length?(o.find(".item-list-counter").text(l.find("li").length),m.length>0&&r(".confirm-footer").show().find("[name=ids]").val(m.join(","))):console.error("SM: items and ids has different counts")}})}(jQuery)});
