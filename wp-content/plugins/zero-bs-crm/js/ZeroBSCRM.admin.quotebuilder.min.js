var quoteTemplateBlocker=!1;function zbscrm_appendTextToEditor(e){"function"==typeof window.parent.send_to_editor&&window.parent.send_to_editor(e)}function zbscrm_getTemplatedQuote(t,o){if(!window.quoteTemplateBlocker){window.quoteTemplateBlocker=!0;var e=0<jQuery("#zbscq_customer").length?parseInt(jQuery("#zbscq_customer").val()):-1,a=0<jQuery("#zbs_quote_template_id").length?parseInt(jQuery("#zbs_quote_template_id").val()):-1,l=0<jQuery("#name").length?jQuery("#name").val():"",r=0<jQuery("#val").length?jQuery("#val").val():"",i=0<jQuery("#date").length?jQuery("#date").val():"",u={};if(2<zbscrm_JS_DAL()&&jQuery.map(jQuery("#zbs-edit-form").serializeArray(),function(e,t){u[e.name]=e.value}),!(0<e))return swal({title:"Error!",text:"Please Choose a Customer",type:"error",confirmButtonText:"OK"}),window.quoteTemplateBlocker=!1;0<a?((quoteTemplateAJAX=jQuery.ajax({url:ajaxurl,type:"POST",data:{action:"zbs_get_quote_template",quote_fields:u,cust_id:e,quote_type:a,quote_title:l,quote_val:r,quote_dt:i,security:jQuery("#quo-ajax-nonce").val()},dataType:"json"})).done(function(e){1==e.error||-1==e.processed?(swal({title:"Error!",text:"Failed retrieving template! If this error persists please contact Jetpack CRM support.",type:"error",confirmButtonText:"OK"}),"function"==typeof o&&o()):(swal({title:"Success!",text:"Quote Template Populated",type:"success",confirmButtonText:"OK"}),setTimeout(function(){zbscrm_appendTextToEditor(e.html)},500),0<jQuery("#title").length&&""==jQuery("#title").val()&&jQuery("#title").val(e.template_title),0<jQuery("#value").length&&""==jQuery("#value").val()&&jQuery("#value").val(e.template_value),0<jQuery("#notes").length&&""==jQuery("#notes").val()&&jQuery("#notes").val(e.template_notes),"function"==typeof t&&t()),window.quoteTemplateBlocker=!1}),quoteTemplateAJAX.fail(function(e){swal({title:"Error!",text:"Failed retrieving template! If this error persists please contact Jetpack CRM support.",type:"error",confirmButtonText:"OK"}),"function"==typeof o&&o(),window.quoteTemplateBlocker=!1})):("function"==typeof t&&t(),window.quoteTemplateBlocker=!1)}}function jpcrm_quotes_send_email_modal(){var e,t,o=jQuery("#zbsQuoteBuilderEmailTo").val();void 0!==o&&""!=o&&zbscrm_JS_validateEmail(o)?(e='<div id="jpcrm_quote_email_modal_opts">',e=(e=(e+='<div class="jpcrm-send-email-modal-field">')+'<label for="jpcrm_quote_email_modal_toemail">'+jpcrm_quotes_lang("toemail")+"</label>")+'<input type="email" id="jpcrm_quote_email_modal_toemail" value="'+o+'" placeholder="'+jpcrm_quotes_lang("toemailplaceholder")+'" /></div>',0<jQuery(".zbsFileLine").length&&(t="",e=(e=(e+='<div class="jpcrm-send-email-modal-field">')+'<input type="checkbox" id="jpcrm_quote_email_modal_attachassoc" value="1" '+(t=jQuery("#zbsc_sendattachments").is(":checked")?'checked="checked" ':t)+"/>")+'<label for="jpcrm_quote_email_modal_attachassoc">'+jpcrm_quotes_lang("attachassoc")+"</label></div>"),e=(e=e+'<div class="jpcrm-send-email-modal-field"><input type="checkbox" id="jpcrm_quote_email_modal_attachaspdf" value="1" '+(t='checked="checked" ')+"/>")+'<label for="jpcrm_quote_email_modal_attachaspdf">'+jpcrm_quotes_lang("attachpdf")+"</label></div></div>",swal({title:jpcrm_quotes_lang("send_email"),html:'<div class="ui segment">'+jpcrm_quotes_lang("sendthisemail")+e+"</div>",type:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:jpcrm_quotes_lang("sendthemail")}).then(function(e){var t,o,a;e.value&&(e=jQuery("#jpcrm_quote_email_modal_toemail").val(),a=parseInt(jQuery("#zbsQuoteBuilderEmailTo").attr("data-quoteid")),void 0!==e&&""!=e&&zbscrm_JS_validateEmail(e)&&0<a?(t=-1,0<jQuery("#jpcrm_quote_email_modal_attachassoc").length&&jQuery("#jpcrm_quote_email_modal_attachassoc").is(":checked")&&(t=1),o=-1,0<jQuery("#jpcrm_quote_email_modal_attachaspdf").length&&jQuery("#jpcrm_quote_email_modal_attachaspdf").is(":checked")&&(o=1),a={id:a,cid:jQuery("#zbscq_customer").val(),email:e,attachassoc:t,attachpdf:o},swal.fire({title:jpcrm_quotes_lang("sendingemail"),html:'<div style="clear:both">&nbsp;</div><div class="ui active loader" style="margin-top:2em;padding-bottom:2em"></div><div style="clear:both">&nbsp;</div>',showConfirmButton:!1,showCancelButton:!1,allowOutsideClick:!1}),jpcrm_quotes_send_email(a)):swal.fire(jpcrm_quotes_lang("sendneedsassignment")))})):swal.fire(jpcrm_quotes_lang("sendneedsassignment"))}function jpcrm_quotes_send_email(e){window.jpcrmQuoteBlocker||(window.jpcrmQuoteBlocker=!0,void 0!==e.id&&0<e.id&&void 0!==e.email&&zbscrm_JS_validateEmail(e.email)&&(e={action:"jpcrm_quotes_send_quote",sec:window.zbsEditSettings.nonce,em:e.email,qid:e.id,cid:e.cid,attachassoc:e.attachassoc,attachpdf:e.attachpdf},jQuery.ajax({url:ajaxurl,type:"POST",data:e,dataType:"json",success:function(e){swal(jpcrm_quotes_lang("senttitle"),jpcrm_quotes_lang("sent"),"info"),window.jpcrmQuoteBlocker=!1},error:function(e){swal(jpcrm_quotes_lang("senderrortitle")+" #19v3",jpcrm_quotes_lang("senderror"),"error"),window.jpcrmQuoteBlocker=!1}})))}function jpcrm_quotes_lang(e,t,o){if(void 0===t&&(t=""),void 0!==window.zbsEditViewLangLabels[e]){if(void 0===o)return window.zbsEditViewLangLabels[e];if(void 0!==window.zbsEditViewLangLabels[e][o])return window.zbsEditViewLangLabels[e][o]}return t}jQuery(function(){jQuery("#zbsQuoteBuilderStep2").on("click",function(){zbscrm_getTemplatedQuote(function(){jQuery("#wpzbscsub_quotecontent").show(),jQuery("#zerobs-quote-content-edit").show(),jQuery("#wpzbscsub_quoteactions").show(),jQuery("#zerobs-quote-nextstep").show(),jQuery("#zbs-quote-builder-step-1").slideUp(),setTimeout(function(){jQuery("#zbs_quote_content_ifr").css("height","580px"),0<jQuery("#wpzbscsub_quotecontent").length&&jQuery("html, body").animate({scrollTop:jQuery("#wpzbscsub_quotecontent").offset().top},2e3),0<jQuery("#zerobs-quote-content-edit").length&&jQuery("html, body").animate({scrollTop:jQuery("#zerobs-quote-content-edit").offset().top},2e3)},0)})}),jQuery("#zbsQuoteBuilderStep3").on("click",function(){jQuery("#publish").trigger("click")}),jQuery("#zbsQuoteBuilderEmailTo").on("keyup",function(){var e=jQuery("#zbsQuoteBuilderEmailTo").val();void 0!==e&&""!=e&&zbscrm_JS_validateEmail(e)?(jQuery("#zbsQuoteBuilderEmailTo").css("border","1px solid #ddd"),jQuery("#zbsQuoteBuilderEmailToErr").hide()):(jQuery("#zbsQuoteBuilderEmailTo").css("border","2px solid orange"),jQuery("#zbsQuoteBuilderEmailToErr").show())}),jQuery("#zbsQuoteBuilderSendNotification").off("click").on("click",function(e,t){jpcrm_quotes_send_email_modal()}),void 0!==window.zbscrm_templated&&(jQuery("#zbs-quote-builder-step-1").hide(),jQuery("#wpzbscsub_quotecontent").show(),jQuery("#zerobs-quote-content-edit").show(),jQuery("#wpzbscsub_quoteactions").show(),jQuery("#zerobs-quote-nextstep").show()),jQuery("#zbsQuoteBuilderURL").length&&(document.getElementById("zbsQuoteBuilderURL").onclick=function(){this.select(),document.execCommand("copy")})});