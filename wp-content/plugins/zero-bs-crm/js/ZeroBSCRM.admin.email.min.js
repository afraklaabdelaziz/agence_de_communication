function zbscrmjs_customer_setCustomerEmail(e){void 0!==e.id&&(jQuery("#zbs-send-email-to").val(e.email),document.getElementById("email_contact_selector").classList.toggle("hidden",""!=e.email))}jQuery(function(l){l(".inbox-nav .item").on("click",function(e){l(".inbox-nav .item").removeClass("active"),l(".zbs-email-list-item ").removeClass("active"),l("#zbs-email-body").hide(),l("#zbs-send-single-email, #zbs-send-single-email-ui").hide(),l("#zbs-email-send-message-thread").hide(),l(".click-email-to-load").show(),l(".zbs-ajax-loading").show(),l(this).addClass("active")}),l(".zbs-email-actions .star").on("click",function(e){var a;l(this).hasClass("outline")?(a={action:"zbs_email_star_thread",emid:window.zbs_star_id,sec:window.zbs_root.zbsnonce},jQuery.ajax({type:"POST",url:ajaxurl,data:a,dataType:"json",timeout:2e4,success:function(e){l(".zbs-list-fav-"+window.zbs_star_id).show()},error:function(e){}}),l(this).addClass("yellow").removeClass("outline"),l(".starred-email-list .zbs-email-list-"+window.zbs_star_id).show()):(a={action:"zbs_email_unstar_thread",emid:window.zbs_star_id,sec:window.zbs_root.zbsnonce},jQuery.ajax({type:"POST",url:ajaxurl,data:a,dataType:"json",timeout:2e4,success:function(e){l(".zbs-list-fav-"+window.zbs_star_id).hide()},error:function(e){}}),l(this).removeClass("yellow").addClass("outline"),l(".starred-email-list .zbs-email-list-"+window.zbs_star_id).hide())}),l(".zbs-inbox-compose-email").on("click",function(e){e.preventDefault(),l(".zbs-email-list").hide(),l(".zbs-email-content").hide(),l(".zbs-email-contact-info").hide(),l("#zbs-send-single-email, #zbs-send-single-email-ui").show(),l(".inbox-nav .item").removeClass("active blue"),l(".zbs-email-list-item ").removeClass("active"),l(".zbs-drafts-link").addClass("active blue")}),l(".zbs-email-actions .trash").on("click",function(e){swal({title:"Are you sure?",text:"This will delete the email thread and remove it from your database. You can not undo this",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes delete the email!"}).then(function(e){var a;e.value&&(e={action:"zbs_delete_email_thread",emid:a=window.zbs_star_id,sec:window.zbs_root.zbsnonce},jQuery.ajax({type:"POST",url:ajaxurl,data:e,dataType:"json",timeout:2e4,success:function(e){swal("Email thread deleted!","Your email thread has been removed.","success"),l("#zbs-email-body").hide(),l("#zbs-email-send-message-thread").hide(),l(".zbs-email-contact-info").hide(),l(".click-email-to-load").show(),l(".zbs-ajax-loading").show(),l(".zbs-email-list-"+a).remove()},error:function(e){swal("Email Thread Not Deleted!","Your email thread was not removed, please try again.","warning")}}))})}),l(".zbs-email-list-item").on("click",function(e){l(".zbs-email-thread").html(""),window.zbs_star_id=l(this).data("emid"),window.zbs_fav=l(this).data("fav"),window.zbs_cid=l(this).data("cid"),l(this).hasClass("zbs-unread-0")&&l(this).removeClass("zbs-unread-0").addClass("zbs-unread-1"),l(".edit-contact-link").attr("href",window.zbsContactEditPrefix+window.zbs_cid),l(".zbs-email-list-item").removeClass("active"),l(".click-email-to-load, .reply-sent").hide(),l(this).addClass("active"),1==window.zbs_fav?l(".zbs-email-actions .star").addClass("yellow").removeClass("outline"):l(".zbs-email-actions .star").removeClass("yellow").addClass("outline"),l(".zbs-email-read-date").hide(),l("#zbs-email-body").hide(),l(".zbs-ajax-loading").show(),l(".spinner-gif").show(),jQuery("#zbs-couldnotload").remove(),the_content=l("the_content",this).html(),l(".spinner-gif").show();var a={action:"zbs_email_customer_panel",cid:l(this).data("cid"),emid:l(this).data("emid"),sec:window.zbs_root.zbsnonce};jQuery.ajax({type:"POST",url:ajaxurl,data:a,dataType:"json",timeout:2e4,success:function(e){l("#panel-customer-avatar").html(e.avatar),l("#panel-name").html(e.customer.fname+" "+e.customer.lname),l("#panel-status").html(e.customer.status),l(".panel-customer-email").html(e.customer.email),l(".panel-customer-phone").html(e.customer.hometel),l(".the-tasks").html("");var s=0,t=0,i=0;l.each(e.tasks,function(e,a){i++,1==a.complete?(l(".the-tasks").append('<li class="complete"><i class="ui icon check green circle"></i>'+a.title+"</li>"),s++):(l(".the-tasks").append('<li class="incomplete">'+a.title+"</li>"),t++)}),0==i&&l(".the-tasks").html("<div class='no-tasks'>No Tasks for this contact</div>"),l(".total-tasks-panel").html(i),l(".completed-tasks-panel").html(s),l(".inprogress-tasks-panel").html(t),"Customer"==e.customer.status&&l("#panel-status").removeClass("blue").addClass("green"),"Lead"==e.customer.status&&l("#panel-status").addClass("blue").removeClass("green"),l(".total-paid .the_value").html(e.trans_value),l(".total-due .the_value").html(e.quote_value),l(".zbs-date").html(e.email_date),l(".zbs-email-subject").html(e.email.zbsmail_subject),l.each(e.email,function(e,a){l(".zbs-email-thread").append('<div class="zbs-date>'+a.date+"</div>"),l(".zbs-email-thread").append('<div class="zbs-email-subject em-sub-'+e+'">'+a.zbsmail_subject+"</div>"),l(".zbs-email-thread").append('<div class="zbs-email-body-content '+a.in_or_out+'" id="zbsbody'+a.the_id+'">'+unescape(a.zbsmail_content)+"</div>"),l("#zbsbody"+a.the_id).append('<div class="pointer'+a.in_or_out+'"></div>'),l(".zbs-email-thread").append('<div class="email-avatar avatar-'+a.in_or_out+'">'+a.avatar+"</div>"),l(".zbs-email-thread").append('<div class="clear"></div>'),0<a.zbsmail_opened&&l(".zbs-email-thread").append('<div class="zbsread'+a.in_or_out+'"><span class="bold">Read:</span> '+a.zbsmail_lastopened+"</div>")}),1==e.email.zbsmail_opened?l(".zbs-email-read-date").show():l(".zbs-email-read-date").hide(),l(".zbs-email-content").css("background","white"),l(".zbs-ajax-loading").hide(),l(".click-email-to-load").hide(),l(".spinner-gif").hide(),jQuery("#zbs-couldnotload").remove(),l("#zbs-email-body").show(),l(".zbs-email-content").fadeIn(1e3),l(".zbs-email-contact-info").fadeIn(1e3),l("#zbs-email-send-message-thread").show()},error:function(e){l(".mark-complete-task button").removeClass("disabled"),completeBlocker=!0,l(".spinner-gif").hide(),jQuery("#zbs-couldnotload").remove(),jQuery(".zbs-ajax-loading").append('<p id="zbs-couldnotload">'+zbsEmailSingleLang.couldnotload+"</p>")}})}),l(".zbs-inbox-link").on("click",function(e){l(".app-content").hide(),l(".click-email-to-load").show(),l(".spinner-gif").hide(),l(".inbox-email-list, .zbs-email-content").fadeIn(1e3)}),l(".zbs-sent-link").on("click",function(e){l(".app-content").hide(),l(".click-email-to-load").show(),l(".spinner-gif").hide(),l(".sent-email-list, .zbs-email-content").fadeIn(1e3)}),l(".zbs-starred-link").on("click",function(e){l(".app-content").hide(),l(".click-email-to-load").show(),l(".spinner-gif").hide(),l(".starred-email-list, .zbs-email-content").fadeIn(1e3)}),l(".zbs-send-email-thread-button").on("click",function(e){the_thread_id=window.zbs_star_id,the_thread_message=tinymce.get("zbs_send_email_thread").getContent(),the_customer_id=window.zbs_cid,the_thread_subject=l(".em-sub-0").html();var a={action:"zbs_email_send_thread_ui",emid:the_thread_id,cid:the_customer_id,"zbs-send-email-title":the_thread_subject,zbs_send_email_content:the_thread_message,sec:window.zbs_root.zbsnonce};jQuery.ajax({type:"POST",url:ajaxurl,data:a,dataType:"json",timeout:2e4,success:function(e){tinymce.get("zbs_send_email_thread").setContent(""),l("#zbs-email-body, #zbs-email-send-message-thread").hide(),l(".zbs-ajax-loading").show(),l(".zbs-ajax-loading").append('<div class="reply-sent"><i class="ui icon check green circle"></i></div>'),l(".reply-sent").append("<h3>Email Sent</h3>")},error:function(e){}})})});