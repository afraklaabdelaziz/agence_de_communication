function zeroBSCRMJS_segment_bindPostRender(){jQuery(".zbs-segment-edit-var-condition-type").off("change").on("change",function(){jQuery(this).closest(".zbs-segment-edit-condition").addClass("dirty"),zeroBSCRMJS_segment_buildConditionCascades()}),jQuery(".zbs-segment-edit-var-condition-operator").off("change").on("change",function(){jQuery(this).closest(".zbs-segment-edit-condition").addClass("dirty"),zeroBSCRMJS_segment_buildConditionCascades2()}),jQuery("#zbs-segment-edit-act-add-condition").off("click").on("click",function(){var e=zeroBSCRMJS_segment_buildConditionLine(!1);jQuery("#zbs-segment-edit-conditions").append(e),setTimeout(function(){jQuery(".zbs-segment-edit-condition").last().addClass("dirty"),zeroBSCRMJS_segment_buildConditionCascades(),setTimeout(function(){zeroBSCRMJS_segment_bindPostRender()},0)},0)}),jQuery(".zbs-segment-edit-condition-remove").off("click").on("click",function(){1<jQuery(".zbs-segment-edit-condition").length?jQuery(this).closest(".zbs-segment-edit-condition").remove():(jQuery("#zbs-segment-edit-conditions-err").show(),setTimeout(function(){jQuery("#zbs-segment-edit-conditions-err").hide()},1800))}),jQuery(".zbs-segment-edit-condition-remove").off("hover").on("mouseenter",function(){jQuery(this).addClass("orange")}).on("mouseleave",function(){jQuery(this).removeClass("orange")}),jQuery("#zbs-segment-edit-act-p2preview").off("click").on("click",function(){zeroBSCRMJS_segment_previewAudience()}),jQuery("#zbs-segment-edit-act-p2submit, #zbs-segment-edit-act-save").off("click").on("click",function(){zeroBSCRMJS_segment_saveSegmentAct()}),jQuery("#zbs-segment-edit-act-back").off("click").on("click",function(){window.location=window.zbsSegmentListURL})}function zeroBSCRMJS_segment_buildConditions(){var n="";void 0!==window.zbsSegment&&void 0!==window.zbsSegment.conditions?jQuery.each(window.zbsSegment.conditions,function(e,t){n+=zeroBSCRMJS_segment_buildConditionLine(t)}):n+=zeroBSCRMJS_segment_buildConditionLine(!1),jQuery("#zbs-segment-edit-conditions").append(n),setTimeout(function(){jQuery(".zbs-segment-edit-condition").addClass("dirty"),zeroBSCRMJS_segment_buildConditionCascades(jQuery("#zbs-segment-edit-conditions"))},0)}function zeroBSCRMJS_segment_buildConditionLine(n){var i,o='<div class="zbs-segment-edit-condition ui corner labeled segment"';return void 0!==n&&!1!==n&&(void 0!==n.id&&(o+=' id="zbs-segment-edit-condition-'+n.id+'"'),void 0!==n.operator&&(o+=' data-orig-operator="'+n.operator+'"'),void 0!==n.valueconv&&(o+=' data-orig-value="'+n.valueconv+'"'),void 0!==n.value2conv&&(o+=' data-orig-value2="'+n.value2conv+'"')),o=o+">"+'<div class="ui corner label zbs-segment-edit-condition-remove"><i class="remove icon"></i></div>',void 0!==window.zbsAvailableConditions&&(!1!==n&&void 0!==window.zbsAvailableConditions&&void 0===window.zbsAvailableConditions[n.type]?o+='<i class="red exclamation triangle icon"></i> <input type="text" disabled="disabled" class="zbs-segment-edit-var-condition-type" value="'+n.type+'" />':(o+='<select class="zbs-segment-edit-var-condition-type ui dropdown">',i=!1,jQuery.each(window.zbsAvailableConditions,function(e,t){void 0===t.generic?(o+='<option value="'+e+'"',void 0!==n&&!1!==n&&void 0!==n.type&&n.type==e&&(o+=' selected="selected"'),o+=">"+t.name+"</option>"):i=!0}),i&&(o+='<optgroup label="'+window.zbsSegmentLang.contactfields+'">',jQuery.each(window.zbsAvailableConditions,function(e,t){void 0!==t.generic&&(o+='<option value="'+e+'"',void 0!==n&&!1!==n&&void 0!==n.type&&n.type==e&&(o+=' selected="selected"'),o+=">"+t.name+"</option>")}),o+="</optgroup>"),o+="</select>")),o+="</div>"}function zeroBSCRMJS_segment_buildConditionCascades(){jQuery(".zbs-segment-edit-condition.dirty").each(function(e,t){zeroBSCRMJS_segment_buildConditionCascadesForEle(t)}),setTimeout(function(){zeroBSCRMJS_segment_buildConditionCascades2()},0)}function zeroBSCRMJS_segment_buildConditionCascadesForEle(e){var n,i,t=jQuery(".zbs-segment-edit-var-condition-type",jQuery(e)).val();void 0!==t&&(jQuery(".zbs-segment-edit-var-condition-operator",jQuery(e)).remove(),n="",void 0!==window.zbsAvailableConditions[t]?void 0!==window.zbsAvailableConditions[t].operators&&0<window.zbsAvailableConditions[t].operators.length&&"tag"!=window.zbsAvailableConditions[t].operators[0]&&"tag_transaction"!=window.zbsAvailableConditions[t].operators[0]&&"extsource"!=window.zbsAvailableConditions[t].operators[0]?(i="",void 0!==jQuery(e).attr("data-orig-operator")&&(i=jQuery(e).attr("data-orig-operator")),n+='<select class="zbs-segment-edit-var-condition-operator ui dropdown">',jQuery.each(window.zbsAvailableConditions[t].operators,function(e,t){n+='<option value="'+t+'"',t==i&&(n+=' selected="selected"'),n+=">"+window.zbsAvailableConditionOperators[t].name+"</option>"}),n+="</select>"):"tag"!=window.zbsAvailableConditions[t].operators[0]&&"tag_transaction"!=window.zbsAvailableConditions[t].operators[0]&&"extsource"!=window.zbsAvailableConditions[t].operators[0]||(n+='<input type="hidden" class="zbs-segment-edit-var-condition-operator" value="'+window.zbsAvailableConditions[t].operators[0]+'" />'):(t="",void 0!==jQuery(e).attr("data-orig-operator")&&(t=jQuery(e).attr("data-orig-operator")),n+='<input type="text" disabled="disabled" class="zbs-segment-edit-var-condition-operator segment-condition-errored" value="'+t+'" />'),jQuery(e).append(n))}function zeroBSCRMJS_segment_buildConditionCascades2(){jQuery(".zbs-segment-edit-condition.dirty").each(function(e,t){var n=jQuery(".zbs-segment-edit-var-condition-operator",jQuery(t)).val(),i=jQuery(".zbs-segment-edit-var-condition-type",jQuery(t)).val();if(void 0!==n){jQuery(".zbs-segment-edit-var-condition-value, .zbs-segment-edit-var-condition-value-2, span",jQuery(t)).remove();var o="",s="",a="";switch(void 0!==jQuery(t).attr("data-orig-value")&&(s=jQuery(t).attr("data-orig-value")),void 0!==jQuery(t).attr("data-orig-value2")&&(a=jQuery(t).attr("data-orig-value2")),n){case"istrue":case"isfalse":o+='<input type="hidden" class="zbs-segment-edit-var-condition-value" value="1" />';break;case"equal":case"notequal":"status"==i?(o+='<select class="zbs-segment-edit-var-condition-value ui dropdown">',void 0!==window.zbsAvailableStatuses&&0<window.zbsAvailableStatuses.length?jQuery.each(window.zbsAvailableStatuses,function(e,t){o+='<option value="'+t+'"',s==t&&(o+=' selected="selected"'),o+=">"+t+"</option>"}):o+='<option value="">'+zeroBSCRMJS_segmentLang("nostatuses")+"</option>",o+="</select>"):o+='<input type="text" class="zbs-segment-edit-var-condition-value" value="'+s+'" />';break;case"contains":case"larger":case"less":o+='<input type="text" class="zbs-segment-edit-var-condition-value" value="'+s+'" />';break;case"before":case"after":o+='<input type="text" class="zbs-date-time zbs-segment-edit-var-condition-value" value="'+s+'" />';break;case"daterange":o+='<input type="text" class="zbs-date-range-condition zbs-segment-edit-var-condition-value" value="'+s+" - "+a+'" />';break;case"floatrange":o=(o+='<input type="text" class="zbs-float zbs-segment-edit-var-condition-value zbs-segment-pair-input" value="'+s+'" placeholder="'+zeroBSCRMJS_segmentLang("eg")+' 0.00" />')+("<span>"+zeroBSCRMJS_segmentLang("to")+'</span><input type="text" class="zbs-float zbs-segment-edit-var-condition-value-2 zbs-segment-pair-input" value="'+a+'" placeholder="'+zeroBSCRMJS_segmentLang("eg")+' 100.00" />');break;case"intrange":o=(o+='<input type="text" class="zbs-int zbs-segment-edit-var-condition-value zbs-segment-pair-input" value="'+s+'" placeholder="'+zeroBSCRMJS_segmentLang("eg")+' 0" />')+("<span>"+zeroBSCRMJS_segmentLang("to")+'</span><input type="text" class="zbs-int zbs-segment-edit-var-condition-value-2 zbs-segment-pair-input" value="'+a+'" placeholder="'+zeroBSCRMJS_segmentLang("eg")+' 100" />');break;case"tag":o+='<select class="zbs-segment-edit-var-condition-value ui dropdown">',void 0!==window.jpcrm_available_contact_tags&&0<window.jpcrm_available_contact_tags.length?jQuery.each(window.jpcrm_available_contact_tags,function(e,t){o+='<option value="'+t.id+'"',s==t.id&&(o+=' selected="selected"'),o+=">"+t.name+"</option>"}):o+='<option value="">'+zeroBSCRMJS_segmentLang("notags")+"</option>",o+="</select>";break;case"tag_transaction":o+='<select class="zbs-segment-edit-var-condition-value ui dropdown">',void 0!==window.jpcrm_available_transaction_tags&&0<window.jpcrm_available_transaction_tags.length?jQuery.each(window.jpcrm_available_transaction_tags,function(e,t){o+='<option value="'+t.id+'"',s==t.id&&(o+=' selected="selected"'),o+=">"+t.name+"</option>"}):o+='<option value="">'+zeroBSCRMJS_segmentLang("notags")+"</option>",o+="</select>";break;case"extsource":o+='<select class="zbs-segment-edit-var-condition-value ui dropdown">',void 0!==window.jpcrm_external_source_list&&0<window.jpcrm_external_source_list.length?jQuery.each(window.jpcrm_external_source_list,function(e,t){o+='<option value="'+t.key+'"',s==t.key&&(o+=' selected="selected"'),o+=">"+t.name+"</option>"}):o+='<option value="">'+zeroBSCRMJS_segmentLang("noextsources")+"</option>",o+="</select>"}void 0===window.zbsAvailableConditions[i]&&(n=s,""!=a&&(n+="-"+a),o=(o='<input type="hidden" class="zbs-segment-edit-var-condition-value" value="'+s+'" />')+'<input type="hidden" class="zbs-segment-edit-var-condition-value-2" value="'+a+'" /><input type="text" disabled="disabled" class="segment-condition-errored" value="'+n+'" />'),jQuery(t).append(o),void 0!==jQuery(t).attr("data-orig-value")&&jQuery(t).removeAttr("data-orig-value"),void 0!==jQuery(t).attr("data-orig-value2")&&jQuery(t).removeAttr("data-orig-value2"),void 0!==jQuery(t).attr("data-orig-operator")&&jQuery(t).removeAttr("data-orig-operator"),setTimeout(function(){zbscrm_JS_bindDateRangePicker(),zeroBSCRMJS_segment_bindDateRangePicker(),zeroBSCRMJS_segment_bindPostRender()},0)}jQuery(t).removeClass("dirty")})}function zeroBSCRMJS_segment_bindDateRangePicker(){var e={format:"DD.MM.YYYY",cancelLabel:"Clear"};void 0!==window.zbs_root.localeOptions&&(e=window.zbs_root.localeOptions),jQuery(".zbs-date-range-condition").daterangepicker({alwaysShowCalendars:!0,opens:"left",showDropdowns:!0,locale:e,ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},callback:function(e,t,n){}})}function zeroBSCRMJS_segment_previewAudience(){var o,e="zbs-segment-edit-var-title",t=jQuery("#"+e).val(),n=jQuery("#zbs-segment-edit-var-matchtype").val(),i=0;zeroBSCRMJS_genericCheckNotEmptySemantic(e)||(i++,jQuery("#zbs-segment-edit-var-title").focus()),jQuery("#zbs-segment-edit-emptypreview-err").hide(),0==i&&(o=[],jQuery(".zbs-segment-edit-condition").each(function(e,t){var n=jQuery(".zbs-segment-edit-var-condition-type",jQuery(t)).val(),i=jQuery(".zbs-segment-edit-var-condition-operator",jQuery(t)).val(),n={type:n,operator:i=void 0!==i&&"undefined"!=i?i:-1,value:jQuery(".zbs-segment-edit-var-condition-value",jQuery(t)).val(),value2:jQuery(".zbs-segment-edit-var-condition-value-2",jQuery(t)).val()};o.push(n)}),0<o.length?(jQuery("#zbs-segment-edit-act-p2preview").addClass("loading"),jQuery("#zbs-segment-edit-act-save, #zbs-segment-edit-act-delete").addClass("loading"),e={title:t,matchtype:n,conditions:o},void 0!==window.zbsSegment&&void 0!==window.zbsSegment.id&&(e.id=window.zbsSegment.id),zeroBSCRMJS_segment_previewSegment(e,function(e){var i="";0==(e=void 0===e?{list:[],count:0}:e).count?(i="",jQuery("#zbs-segment-edit-emptypreview-err").show()):(i=(i+='<h2 class="ui header" style="margin-left:0">'+e.count+" "+zeroBSCRMJS_segmentLang("currentlyInSegment")+"</h2>")+'<table class="ui celled striped table"><thead><tr><th colspan="2">'+zeroBSCRMJS_segmentLang("previewTitle")+":</th></tr></thead><tbody>",jQuery.each(e.list,function(e,t){var n=t.fullname,t=(""==n&&(n=zeroBSCRMJS_segmentLang("noName")),t.email);""==t&&(t=zeroBSCRMJS_segmentLang("noEmail")),i+="<tr><td>"+n+"</td><td>"+t+"</td></tr>"}),i+="</tbody></table>"),jQuery("#zbs-segment-edit-preview-output").html(i),jQuery("#zbs-segment-edit-act-p2preview").removeClass("loading"),jQuery("#zbs-segment-edit-act-save, #zbs-segment-edit-act-delete").removeClass("loading").prop("disabled",!1),jQuery("#zbs-segment-edit-preview").show()},function(e){jQuery("#zbs-segment-edit-act-p2preview").removeClass("loading"),jQuery("#zbs-segment-edit-act-save, #zbs-segment-edit-act-delete").removeClass("loading").prop("disabled",!1),swal(zeroBSCRMJS_segmentLang("generalerrortitle")+" #219",zeroBSCRMJS_segmentLang("generalerror"),"error")})):(jQuery("#zbs-segment-edit-conditions-err").show(),setTimeout(function(){jQuery("#zbs-segment-edit-conditions-err").hide()},1800)))}function zeroBSCRMJS_segment_saveSegmentAct(){var o,i,e="zbs-segment-edit-var-title",t=jQuery("#"+e).val(),n=jQuery("#zbs-segment-edit-var-matchtype").val(),s=0;zeroBSCRMJS_genericCheckNotEmptySemantic(e)||(s++,jQuery("#zbs-segment-edit-var-title").focus()),0==s&&(jQuery("#zbs-segment-edit-act-p2submit").addClass("loading").attr("disabled","disabled"),jQuery("#zbs-segment-edit-act-p2preview").addClass("loading").attr("disabled","disabled"),jQuery("#zbs-segment-edit-act-save, #zbs-segment-edit-act-delete").addClass("loading").attr("disabled","disabled"),o=[],jQuery(".zbs-segment-edit-condition").each(function(e,t){var n=jQuery(".zbs-segment-edit-var-condition-type",jQuery(t)).val(),i=jQuery(".zbs-segment-edit-var-condition-operator",jQuery(t)).val(),n={type:n,operator:i=void 0!==i&&"undefined"!=i?i:-1,value:jQuery(".zbs-segment-edit-var-condition-value",jQuery(t)).val(),value2:jQuery(".zbs-segment-edit-var-condition-value-2",jQuery(t)).val()};o.push(n)}),0<o.length?(i={title:t,matchtype:n,conditions:o},void 0!==window.zbsSegment&&void 0!==window.zbsSegment.id&&(i.id=window.zbsSegment.id),zeroBSCRMJS_segment_saveSegment(i,function(e){var t=!1,n=(0==window.zbsSegment&&(t=!0),i);window.zbsSegment.id=e,window.zbsSegment.name=n.title,window.zbsSegment.matchtype=n.matchtype,window.zbsSegment.conditions=n.conditions,jQuery("#zbs-segment-edit-preview-output").html(""),jQuery("#zbs-segment-edit-preview").show(),jQuery("#zbs-segment-edit-act-p2submit").removeClass("loading").prop("disabled",!1),jQuery("#zbs-segment-edit-act-p2preview").removeClass("loading").prop("disabled",!1),jQuery("#zbs-segment-edit-act-save, #zbs-segment-edit-act-delete").removeClass("loading").prop("disabled",!1),jQuery("#zbs-segment-edit-act-save").html(window.zbsSegmentLang.savedSegment),setTimeout(function(){jQuery("#zbs-segment-edit-act-save").html(window.zbsSegmentLang.saveSegment)},1500),t&&(window.location=window.zbsSegmentStemURL+e)},function(e){jQuery("#zbs-segment-edit-act-p2submit").removeClass("loading").prop("disabled",!1),jQuery("#zbs-segment-edit-act-p2preview").removeClass("loading").prop("disabled",!1),jQuery("#zbs-segment-edit-act-save, #zbs-segment-edit-act-delete").removeClass("loading").prop("disabled",!1),swal(zeroBSCRMJS_segmentLang("generalerrortitle")+" #221",zeroBSCRMJS_segmentLang("generalerror"),"error")})):(jQuery("#zbs-segment-edit-conditions-err").show(),jQuery("#zbs-segment-edit-act-p2submit").removeClass("loading").prop("disabled",!1),jQuery("#zbs-segment-edit-act-p2preview").removeClass("loading").prop("disabled",!1),jQuery("#zbs-segment-edit-act-save, #zbs-segment-edit-act-delete").removeClass("loading").prop("disabled",!1),setTimeout(function(){jQuery("#zbs-segment-edit-conditions-err").hide()},1800)))}function zeroBSCRMJS_genericCheckNotEmptySemantic(e){var t=jQuery("#"+e).val();return void 0===t||t.length<1?(jQuery("#"+e).closest(".field").addClass("error"),jQuery(".ui.message",jQuery("#"+e).closest(".field")).show(),!1):(jQuery("#"+e).closest(".field").removeClass("error"),jQuery(".ui.message",jQuery("#"+e).closest(".field")).hide(),!0)}jQuery(function(){zeroBSCRMJS_segment_buildConditions(),setTimeout(function(){zeroBSCRMJS_segment_bindPostRender()},0)});var zbsAJAXSending=!1;function zeroBSCRMJS_segment_saveSegment(e,t,n){var i;window.zbsAJAXSending||(window.zbsAJAXSending=!0,i=-1,i={action:"zbs_segment_savesegment",sID:i=void 0!==e&&void 0!==e.id?e.id:i,sec:window.zbsSegmentSEC},void 0!==e.title&&(i.sTitle=e.title),void 0!==e.matchtype&&(i.sMatchType=e.matchtype),void 0!==e.conditions&&(i.sConditions=e.conditions),jQuery.ajax({type:"POST",url:ajaxurl,data:i,timeout:2e4,success:function(e){return window.zbsAJAXSending=!1,"function"==typeof t&&t(e.id),!0},error:function(e){return window.zbsAJAXSending=!1,"function"==typeof n&&n(e),!1}}))}function zeroBSCRMJS_segment_previewSegment(e,t,n){var i;window.zbsAJAXSending||(window.zbsAJAXSending=!0,i=-1,i={action:"zbs_segment_previewsegment",sID:i=void 0!==e&&void 0!==e.id?e.id:i,sec:window.zbsSegmentSEC},void 0!==e.title&&(i.sTitle=e.title),void 0!==e.matchtype&&(i.sMatchType=e.matchtype),void 0!==e.conditions&&(i.sConditions=e.conditions),jQuery.ajax({type:"POST",url:ajaxurl,data:i,timeout:2e4,success:function(e){return window.zbsAJAXSending=!1,"function"==typeof t&&t(e),!0},error:function(e){return window.zbsAJAXSending=!1,"function"==typeof n&&n(e),!1}}))}function zeroBSCRMJS_segmentLang(e){return void 0!==window.zbsSegmentLang[e]?window.zbsSegmentLang[e]:""}